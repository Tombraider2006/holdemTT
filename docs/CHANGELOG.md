# Changelog

## [2025-01-XX] - Начало разработки

### Добавлено
- Изучен репозиторий PokerServer (jacobhyphenated/PokerServer) на GitHub
- Создана структура Android проекта для техасского холдема
- Реализована игровая логика на основе найденного репозитория

### Модели данных
- `Card` - игральная карта с мастью и достоинством
- `Deck` - колода из 52 карт с перемешиванием
- `Player` - игрок с фишками, картами и состоянием
- `HandRank` - ранги покерных комбинаций
- `HandEvaluation` - результат оценки руки

### Игровая логика
- `GameEngine` - основной игровой движок
  - Управление раздачами
  - Обработка действий игроков (fold, check, call, bet, raise, all-in)
  - Переходы между этапами игры (pre-flop, flop, turn, river, showdown)
  - Определение победителя
- `PokerHandEvaluator` - оценка покерных комбинаций
  - Определение всех стандартных комбинаций
  - Сравнение рук для определения победителя

### AI
- `SimpleAI` - простой AI противник
  - Принятие решений на основе силы руки
  - Учет pot odds
  - Стратегия для pre-flop и post-flop

### UI (Jetpack Compose)
- `GameScreen` - главный экран игры
- `CardView` - компонент отображения карты
- `PlayerView` - компонент отображения игрока
- `ActionButtons` - кнопки действий игрока
- Тема приложения с зеленым столом

### Исправлено
- Исправлена ошибка в `Card.kt` (sit -> suit)
- Добавлен доступ к currentBet в GameEngine
- Исправлена логика отображения кнопок действий

### Улучшено
- Улучшено отображение стека игроков (фишки) с подписью "Стек:"
- Улучшено отображение текущих ставок игроков с подписью "Ставка:"
- Добавлено отображение блайндов (SB/BB) в информации о банке
- Добавлено отображение размера блайндов для каждого игрока
- Улучшена визуализация информации о ставках в центре стола
- Добавлена информация о размере колла и рейза на кнопках действий

### Добавлено - Подсказки и стратегии (2025)
- **BettingHelper** - система подсказок по ставкам на основе GTO стратегии
  - Расчет оптимальных размеров ставок
  - Анализ pot odds и equity
  - Рекомендации по действиям (fold, check, call, bet, raise, all-in)
  - Учет позиции и текстуры доски
  - Адаптивные размеры ставок в зависимости от силы руки
  
- **RangeAnalyzer** - анализ диапазонов рук оппонентов
  - Современные solver-based алгоритмы 2025
  - Сужение диапазона на основе действий оппонента
  - Оценка силы диапазона (средняя, максимальная, минимальная)
  - Распределение силы рук в диапазоне
  - Учет позиции при анализе
  - Определение наиболее вероятных рук оппонента
  
- **UI компоненты для подсказок**
  - BettingHints - отображение рекомендаций по ставкам
  - OpponentRangeView - визуализация анализа диапазона оппонента
  - Индикаторы уверенности и статистика
  
- **Интеграция в игровой процесс**
  - Автоматическое обновление подсказок при каждом ходе
  - Отслеживание действий оппонентов для анализа диапазона
  - Отображение подсказок только для игрока (не для AI)

### Исправлено - Логика ставок
- Исправлена ошибка в расчете pot при CALL/BET/RAISE - теперь правильно учитывается только новая ставка
- Исправлена логика обновления currentBet при ставках
- Улучшена обработка all-in ситуаций

### Локализация
- Все тексты интерфейса переведены на русский язык
- Все подсказки и рекомендации на русском
- Кодировка UTF-8 настроена для всех файлов
- Названия игроков: "Вы", "ИИ 1", "ИИ 2", "ИИ 3"
- Кнопки действий: "Сбросить", "Чек", "Колл", "Ставка", "Рейз", "Олл-ин"
- Подсказки: "Подсказка", "Уверенность", "Вероятность", "Pot Odds"
- Анализ оппонентов: "Анализ диапазона оппонента", "Сильные", "Средние", "Слабые"

### GitHub Actions
- Создан workflow для автоматической сборки APK
- Добавлен gradle-wrapper.jar в репозиторий для надежной сборки
- Настроена автоматическая загрузка gradle-wrapper.jar (fallback)
- Добавлен кеш для ускорения сборки
- Улучшена настройка Android SDK
- APK доступны в разделе Actions → Artifacts
- Создан скрипт для автоматического ожидания сборки и обновления релиза

### Репозиторий и релиз
- Репозиторий: https://github.com/Tombraider2006/holdemTT
- Релиз v0.1 создан: https://github.com/Tombraider2006/holdemTT/releases/tag/v0.1
- Workflow для сборки: https://github.com/Tombraider2006/holdemTT/actions

### Локальная сборка
- Создан скрипт `build-local.ps1` для автоматической сборки APK
- Создан скрипт `setup-java.ps1` для настройки Java
- Скрипты автоматически находят Java (включая JDK из Android Studio)

### Очистка проекта
- Удалены временные скрипты PowerShell (все действия выполняются через CLI команды)
- Обновлен `.gitignore` для исключения временных файлов, артефактов и скриптов
- Удалены директории сборки, кеши и временные файлы

### Инструменты для тестирования
- Установлен Android Platform Tools (ADB) для тестирования APK
- Создана инструкция `INSTALL_ANDROID_TOOLS.md` по установке и использованию
- ADB установлен в `C:\Android\platform-tools`

### Релиз v0.1
- Релиз v0.1 создан: https://github.com/Tombraider2006/holdemTT/releases/tag/v0.1
- APK доступен в разделе Actions → Artifacts после успешной сборки
- Для добавления APK в релиз: скачайте из Artifacts и загрузите через веб-интерфейс или CLI

### Источники
- Репозиторий: https://github.com/jacobhyphenated/PokerServer
- Язык: Java (адаптировано для Kotlin/Android)
- Звезды: 160

## [2025-01-07] - Исправление ошибок компиляции

### Критические ошибки компиляции (исправлено)
- **HandRank.kt:6** - Конфликт имени `name` с базовым классом Enum. Исправлено: переименовано в `displayName`
- **RangeAnalyzer.kt:41** - Несоответствие типов: функция `calculateRangeProbability` ожидала `HandRange`, но получала `List<Pair<Card, Card>>`. Исправлено: изменена сигнатура функции
- **RangeAnalyzer.kt:87** - Несоответствие типов: `evaluatePreFlopStrength` возвращает `Float`, но нужен `Double`. Исправлено: добавлено `.toDouble()`
- **RangeAnalyzer.kt:91-93** - Ошибки с методами `average()`, `maxOrNull()`, `minOrNull()` из-за неправильного типа. Исправлено после исправления типа в строке 87
- **RangeAnalyzer.kt:101-102** - Ошибка "The floating-point literal does not conform to the expected type Nothing". Исправлено после исправления типов выше
- **Theme.kt:30** - Ошибка "Unresolved reference: getWindowInsetsController". Исправлено: заменено на `WindowInsetsControllerCompat(window, view)`

### Проблемы при сборке
- Сборка APK падала из-за множественных ошибок компиляции Kotlin
- Все ошибки были исправлены, проект должен собираться успешно

### Уроки
- Всегда проверять типы возвращаемых значений функций
- Проверять совместимость API при использовании Android библиотек
- Избегать конфликтов имен с базовыми классами (Enum.name уже существует)

## [2025-01-07] - Анализ проекта через Context7

### Анализ архитектуры
- Проведен анализ проекта с использованием Context7 и лучших практик Android
- Создан документ `docs/IMPROVEMENTS.md` с рекомендациями по улучшению

### Найденные проблемы
- Устаревшие версии зависимостей (Compose BOM 2023.10.01, Kotlin 1.9.20)
- Множество отдельных StateFlow вместо единого UiState
- Отсутствие обработки ошибок через Async sealed class
- Не используется WhileUiSubscribed для оптимизации ресурсов
- Отсутствие Repository слоя (логика в ViewModel)
- Отсутствие Dependency Injection (Hilt)
- Использование collectAsState вместо collectAsStateWithLifecycle

### Рекомендации
- Обновить зависимости до актуальных версий (Compose BOM 2024.12.01, Kotlin 2.1.10)
- Внедрить UiState паттерн для единого состояния
- Добавить WhileUiSubscribed для оптимизации StateFlow
- Создать Repository слой для разделения логики
- Добавить Hilt для Dependency Injection
- Использовать collectAsStateWithLifecycle для автоматической остановки сбора

### Приоритеты
- Высокий: обновление зависимостей, UiState паттерн, оптимизация StateFlow ✅
- Средний: Repository слой ✅, Hilt, обработка ошибок
- Низкий: Version Catalog, дополнительные оптимизации

## [2025-01-07] - Добавлен Repository слой

### ✅ Выполнено - Средний приоритет

#### Repository слой
- Создан интерфейс `GameRepository` для единой точки доступа к данным игры
- Реализован `GameRepositoryImpl` с инкапсуляцией бизнес-логики
- Рефакторинг `GameViewModel` для использования Repository вместо прямого доступа к `GameEngine`, `BettingHelper`, `RangeAnalyzer`

**Преимущества:**
- Разделение ответственности (Separation of Concerns)
- Упрощение тестирования (можно мокировать Repository)
- Готовность к добавлению других источников данных (локальное хранение, сеть)
- Чистая архитектура (Clean Architecture)

**Новые файлы:**
- `app/src/main/java/com/holdem/poker/data/GameRepository.kt` - интерфейс и реализация Repository

**Измененные файлы:**
- `app/src/main/java/com/holdem/poker/ui/viewmodel/GameViewModel.kt` - рефакторинг на использование Repository

### Следующие шаги
- Добавление Hilt для Dependency Injection (упростит создание Repository)
- Обработка ошибок через Async sealed class

